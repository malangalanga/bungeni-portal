#summary How to Generate i18n catalogs.
#labels zope,Phase-Implementation
#sidebar TableOfContents

= How to setup i18n scripts =

due to a minor issue in one of the recipes used in buildout, we need to modify the generated i18n scripts to include the path to our xapian library.

so after running buildout you'll need to add an additional 

 '$buildout_directory/parts/xapian/lib/python' 

to the list at the top of the bin/i18nextract script, substituting the full path for $buildout_directory. after which you can use the i18nextract script to generate a message catalog (pot file) for translation.


replace the lines 
{{{
import lovely.recipe.i18n.i18nextract

if __name__ == '__main__':
    lovely.recipe.i18n.i18nextract.main(['i18nextract', '-d', 'bungeni', '-s', '/home/undesa/devel/svn/bungeni-portal/parts/i18n/configure.zcml', '-p', 'src/bungeni.core', '-o', 'locales'])
}}}

with
{{{
import lovely.recipe.i18n.i18nextract
import sys, os

import getopt

argv = sys.argv[1:]

try:                                
    opts, args = getopt.getopt(argv, "p:d:", ["path=", "domain="])
except getopt.GetoptError:          
    usage()                         
    sys.exit(2)       

os.environ["zope_i18n_allowed_languages"] = "en fr pt sw en-ke it"
domain = 'bungeni.core' # can be bungeni.ui or bungeni.models
path = 'src/bungeni.main'
for opt, arg in opts:                
    if opt in ("-p", "--path"):      
        path = arg
    if opt in ("-d", "--domain"):      
        domain = arg

print 'generate locales for domain: ', domain, ' in: ', path
print  
      
if __name__ == '__main__':
    lovely.recipe.i18n.i18nextract.main(['i18nextract', 
        '-d', domain, 
        '-s', '/home/undesa/cinst/bungeni/parts/i18n/configure.zcml', 
        '-p', path, 
        '-o', 'locales'])
}}}

= Manually regenerating .mo files = 

You can manually compile .mo files using `gettext` :
{{{
# install gettext 
sudo apt-get install gettext 

# generate the mo files
cd ./cinst/bungeni/src/bungeni.main/bungeni
for po in `find . -name "*.po"` ; do msgfmt -o `dirname $po`/`basename $po .po`.mo $po; done
}}}
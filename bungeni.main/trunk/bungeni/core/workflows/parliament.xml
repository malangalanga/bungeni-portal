<?xml version="1.0"?>
<workflow id="parliament_workflow"
    title="Parliament Workflow"
    description="Workflow for parliaments"
    domain="bungeni.ui"
    initial_state="">

  <state id="draft" title="Draft - Parliament not yet Active">
    <grant permission="bungeni.group.Delete" role="bungeni.Owner" />
    <grant permission="zope.View" role="bungeni.Clerk" />
    <grant permission="zope.View" role="bungeni.Speaker" />
    <deny permission="zope.View" role="bungeni.MP" />
    <deny permission="zope.View" role="bungeni.Minister" />
    <deny permission="zope.View" role="bungeni.Everybody" /> 
    <deny permission="zope.View" role="bungeni.Anybody" /> 
    <deny permission="bungeni.groupmember.Add" role="bungeni.Clerk" />
    <deny permission="bungeni.groupmember.Edit" role="bungeni.Clerk" />
    <deny permission="bungeni.groupmember.Delete" role="bungeni.Clerk" />
  </state>

  <state id="active" title="Active Parliament">
    <deny permission="bungeni.group.Delete" role="bungeni.Owner" />
    <grant permission="zope.View" role="bungeni.MP" />
    <grant permission="zope.View" role="bungeni.Clerk" />
    <grant permission="zope.View" role="bungeni.Speaker" />
    <grant permission="zope.View" role="bungeni.Minister" />
    <grant permission="zope.View" role="bungeni.Everybody" /> 
    <grant permission="zope.View" role="bungeni.Anybody" />
    <grant permission="bungeni.groupmember.Add" role="bungeni.Clerk" />
    <grant permission="bungeni.groupmember.Edit" role="bungeni.Clerk" />
    <grant permission="bungeni.groupmember.Delete" role="bungeni.Clerk" />
  </state>
  
  <state id="dissolved" title="Parliament is Dissolved">
    <deny permission="bungeni.agendaitem.Add" role="bungeni.MP" />
    <deny permission="bungeni.groupmember.Add" role="bungeni.Clerk" />
    <deny permission="bungeni.groupmember.Edit" role="bungeni.Clerk" />
    <deny permission="bungeni.groupmember.Delete" role="bungeni.Clerk" />
  </state>

  <transition 
     id="create"
     title="Create"
     trigger="automatic"
     source=""
     destination="draft"
     />

  <transition 
     id="activate"
     title="Activate"
     trigger="manual"
     source="draft
            dissolved"
     destination="active"
     permission="bungeni.group.Manage"
     require_confirmation="true"
     />

  <transition 
     id="dissolve"
     title="Dissolve"
     trigger="manual"
     source="active"
     destination="dissolved"
     condition="bungeni.core.workflows.groups.conditions.has_end_date"
     permission="bungeni.group.Manage"
     require_confirmation="true"
     />
                   
  <transition 
     id="deactivate"
     title="Deactivate"
     trigger="manual"
     source="active 
            dissolved"
     destination="draft"
     permission="bungeni.group.Manage"
     require_confirmation="true"
     />


</workflow>

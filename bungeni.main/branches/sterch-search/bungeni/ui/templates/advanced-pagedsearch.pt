<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/@@standard_macros/page">

  <div metal:fill-slot="body" i18n:domain="bungeni.ui">

      <h2 i18n:translate=""> Advanced Search </h2>

      <div tal:condition="view/spelling_suggestion">
          Did you mean <a href="" tal:attributes="href string:${context/@@absolute_url}/search?form.full_text=${view/spelling_suggestion}&amp;form.actions.search=Search"
                                  tal:content="view/spelling_suggestion"> This </a>
      </div>

      <div metal:use-macro="context/@@standard_macros/form">
      
      </div>

      <tal:block condition="python: request.form.get('form.full_text')">

        <h2 i18n:translate="">Results </h2>

        <div tal:content="view/search_status"></div>
        <tal:block tal:condition="view/results">
          <div tal:repeat="item view/results"
            tal:content="structure item/@@searchresult"/>
        </tal:block>

        <tal:block tal:condition="view/pages">
          <div class="pager">
            <a tal:repeat="item view/pages" tal:content="item/number"
              tal:attributes="href item/url"/>
          </div>
        </tal:block>

        <tal:block tal:condition="python: not view.results">
          <em>No Results</em>
        </tal:block>

      </tal:block>
      
  <script type="text/javascript">
  
  	function get_statuses(object_type){
		$.ajax({
			url: 'ajax_get_class_statuses',
			cache: false,
			success: function(data){
				if (data == 'ERROR'){
					window.alert("Error getting statuses for " + object_type);
				}
				else {
					$("#form\\.status").html("");
					$(data).appendTo("#form\\.status");
					$("#field\\.form\\.status").show();
					$("#field\\.form\\.status_date").show();			
				}
			},
			data: {'dotted_name': object_type}
		});	
	}
	
  	$(document).ready(function(){
  		if($("#field\\.form\\.content_type").val()){
  			$("#field\\.form\\.status").show();
  			$("#field\\.form\\.status_date").show();
  		}else{
  			$("#field\\.form\\.status").hide();
  			$("#field\\.form\\.status_date").hide();
  		}
  		
  		$("#form\\.content_type").change(function() { 
  			if($(this).val()){
  				get_statuses($(this).val());
  			}else{
  				$("#field\\.form\\.status").hide();
  			}
  		});
  	});
  </script>

  </div>

</html>

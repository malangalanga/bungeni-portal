<?xml version="1.0"?>
<workflow title="Question Responce Workflow"
    description="Workflow for base Event"
    permission_actions=".View .Edit .Add .Delete"
    >

    <!-- sub-item: NO global grants -->
    
    <!-- features -->
    <feature name="audit" enabled="true" />
    <feature name="version" enabled="true" />
    <feature name="attachment" enabled="true" />
    
    <!-- workflow facets -->
     <!-- NOTE: as guidelines it is useful to think facets in the context of "children document" (e.g. events/attachments) as conceptually divided in two parts:

1) facets that will be used in the parent documents to grant the permission to add/view/delete action on the children document and

2) facets that are used by in the states of the child document itself. In that context .add shuld not be used (it will not be effective anyhow)   -->
    <facet name="add">
        <allow permission=".View" roles="ClerkSenate ClerkAssembly " />
        <allow permission=".Edit" roles="ClerkSenate ClerkAssembly" />
        <allow permission=".Add" roles="ClerkSenate ClerkAssembly" />
        <allow permission=".Delete" roles="ClerkSenate ClerkAssembly" />
    </facet>
    <facet name="view">
        <allow permission=".View" roles="ClerkSenate ClerkAssembly 
            SpeakerSenate SpeakerAssembly" />
        <allow permission=".Edit" roles="ClerkSenate ClerkAssembly
            SpeakerSenate SpeakerAssembly" />
    </facet>

<!-- see public below -->  
   
    <facet name="visible_internally" >
        <allow permission=".View" roles="Authenticated" />
    </facet>
    <facet name="withdrawm" >
        <allow permission=".View" roles="ClerkSenate ClerkAssembly" />
    </facet>

<!-- OLD FROM HERE -->    
    <facet name="internal" default="false">
        <allow permission=".View" roles="Authenticated" />
        <allow permission=".Edit" roles="ClerkSenate ClerkAssembly 
            SpeakerSenate SpeakerAssembly MinistryMember" />
        <allow permission=".Add" roles="ClerkSenate ClerkAssembly 
            SpeakerSenate SpeakerAssembly MinistryMember" />
    </facet>
    <facet name="internal_frozen">
        <allow permission=".View" roles="Authenticated" />
    </facet>
    <facet name="public">
        <allow permission=".View" roles="Anonymous" />
        <allow permission=".Edit" roles="ClerkSenate ClerkAssembly" />
        <allow permission=".Add" roles="ClerkSenate ClerkAssembly" />
    </facet>
    <facet name="public_frozen">
        <allow permission=".View" roles="Anonymous" />
    </facet>
<!-- END OLD HERE -->  
    
    <!-- workflow states -->    
    <state id="draft" title="Draft">
        <facet ref=".add" />
    </state>
    <state id="public" title="Public">
        <facet ref=".public" />
    </state>
    <state id="internal" title="Internal">
        <facet ref=".visible_internally" />
    </state>
    <state id="withdrawn" title="Withdrawn">
        <facet ref=".withdrawm" />
    </state>
    
    
    <!-- workflow transision -->    
    <transition title="Create"
        source=""
        destination="draft"
        trigger="automatic"
    />
    <transition title="Bound to Parent"
        source="draft internal"
        destination="public"
        trigger="manual"
        roles="ClerkSenate ClerkAssembly Owner"
        require_confirmation="true"
    />
    <transition title="Visible Internally"
        source="draft public"
        destination="internal"
        trigger="manual"
        roles="Owner"
        require_confirmation="true"
    />
    <transition title="Withdraw"
        source="internal public"
        destination="withdrawn"
        trigger="manual"
        roles="ClerkSenate ClerkAssembly Owner"
        require_confirmation="true"
    />

</workflow>

<?xml version="1.0"?>
<workflow title="Event Workflow"
    description="Workflow for base Event"
    permission_actions=".View .Edit .Add .Delete"
    >
    
    <!-- sub-item: NO global grants mmmmmm public> attached -->
    
    <!-- features -->
    <feature name="audit" enabled="true" />
    <feature name="version" enabled="true" />
    <feature name="attachment" enabled="true" />
    
    <!-- FACETS -->
    <!-- fz: it is not mandatory and it can be managed differently
	 but the one below is simplest way that I found to deal with management
	 of "child-documents" (events/attachements).
	 We have "parent facets" where you just handle who has the right to "add" a "child-document"
	 and we have "workflow factes" where you handle, as in any document, the permission of the
	 "child document". In these facets you should not use the ".Add" action.
        
         Please also note the different way to refer to facets of
	 default event         <facet ref="event.facet" />
	 default custom event  <facet ref="event#custom.facet" />
   -->

    <!-- parent factes -->  
    <facet name="add_ministry">
        <allow permission=".Add" roles="MinistryMember" />
    </facet>

    <!-- workflow factes --> 
    <facet name="state_draft">
        <allow permission=".View" roles="MinistryMember" />
        <allow permission=".Edit" roles="MinistryMember" />
        <allow permission=".Delete" roles="MinistryMember" />
    </facet>
    <facet name="state_internal" default="true">
        <allow permission=".View" roles="MinistryMember" />
        <allow permission=".Edit" roles="MinistryMember" />
        <allow permission=".Add" roles="MinistryMember" />
    </facet>
    <facet name="state_completed">
        <allow permission=".View" roles="Anonymous" />
        <allow permission=".Edit" roles="MinistryMember ClerkSenate ClerkAssembly SpeakerSenate SpeakerAssembly" />
    </facet>
    <facet name="state_reviewed">
        <allow permission=".View" roles="Anonymous" />
    </facet>
    
    <!-- workflow states -->    
    <state id="draft" title="Draft"> 
	<facet ref=".state_draft" />
    </state>
    <state id="internal" title="Internal">
        <facet ref=".state_internal" />
    </state>
    <state id="completed" title="Completed">
	<facet ref=".state_completed" />
    </state>
    <state id="state_reviewed" title="Reviewed">
	<facet ref=".state_reviewed" />
    </state>
    
    <!-- workflow transision -->    
    <transition title="Create"
        source=""
        destination="draft"
        trigger="automatic"
    />
    <transition title="Internal"
        source="draft"
        destination="internal"
        trigger="manual"
        roles="MinistryMember"
        require_confirmation="true"
    />
    <transition title="Completed"
        source="draft internal"
        destination="completed"
        trigger="manual"
        roles="MinistryMember"
        require_confirmation="true"
    />
    <transition title="Reviewed"
        source="completed"
        destination="state_reviewed"
        trigger="manual"
        roles="ClerkSenate ClerkAssembly"
        require_confirmation="true"
    />

</workflow>
